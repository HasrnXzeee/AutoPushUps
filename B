--[[
    Modern UI Library for Roblox
    Version 1.0.0
    
    A comprehensive, highly customizable UI library for Roblox exploits
    with smooth animations, multiple themes, and extensive features.
]]

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local TextService = game:GetService("TextService")
local CoreGui = game:GetService("CoreGui")
local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

local Library = {
    Theme = {
        Primary = Color3.fromRGB(24, 24, 24),
        Secondary = Color3.fromRGB(30, 30, 30),
        Accent = Color3.fromRGB(85, 170, 255),
        Text = Color3.fromRGB(255, 255, 255),
        TextDark = Color3.fromRGB(175, 175, 175),
        PlaceholderText = Color3.fromRGB(120, 120, 120),
        Background = Color3.fromRGB(18, 18, 18),
        Border = Color3.fromRGB(35, 35, 35),
        WindowBackground = Color3.fromRGB(20, 20, 20),
        TabBackground = Color3.fromRGB(25, 25, 25),
        SectionBackground = Color3.fromRGB(28, 28, 28),
        Success = Color3.fromRGB(0, 255, 128),
        Error = Color3.fromRGB(255, 0, 0),
        Warning = Color3.fromRGB(255, 128, 0),
        Highlight = Color3.fromRGB(85, 170, 255),
        DarkContrast = Color3.fromRGB(14, 14, 14),
        LightContrast = Color3.fromRGB(45, 45, 45)
    },
    Fonts = {
        Regular = Enum.Font.SourceSans,
        Bold = Enum.Font.SourceSansBold,
        Light = Enum.Font.SourceSansLight,
        Semibold = Enum.Font.SourceSansSemibold
    },
    Flags = {},
    Objects = {},
    Connections = {},
    Elements = {},
    Themes = {},
    Settings = {
        CloseBind = Enum.KeyCode.RightControl,
        TweenSpeed = 0.25,
        EasingStyle = Enum.EasingStyle.Quart,
        EasingDirection = Enum.EasingDirection.Out,
        ThemeOverrides = {},
        UseDiscordColors = false,
        UIScale = 1,
        DragSpeed = 0.1,
        UseTooltips = true,
        UseTabSaving = true,
        AnimateUI = true
    },
    Utility = {},
    Selected = {
        Tab = nil,
        Section = nil
    },
    Stats = {
        WindowCount = 0,
        TabCount = 0,
        SectionCount = 0,
        ElementCount = 0
    },
    ZIndexOrder = {
        Window = 10,
        Tab = 11,
        Section = 12,
        Element = 13,
        Dropdown = 14,
        Colorpicker = 15,
        Notification = 16,
        Tooltip = 17
    },
    ScreenGui = nil
}

-- Initialize themes
Library.Themes.Default = Table.clone(Library.Theme)
Library.Themes.Dark = {
    Primary = Color3.fromRGB(18, 18, 18),
    Secondary = Color3.fromRGB(24, 24, 24),
    Accent = Color3.fromRGB(85, 170, 255),
    Text = Color3.fromRGB(240, 240, 240),
    TextDark = Color3.fromRGB(175, 175, 175),
    PlaceholderText = Color3.fromRGB(110, 110, 110),
    Background = Color3.fromRGB(12, 12, 12),
    Border = Color3.fromRGB(30, 30, 30),
    WindowBackground = Color3.fromRGB(15, 15, 15),
    TabBackground = Color3.fromRGB(20, 20, 20),
    SectionBackground = Color3.fromRGB(23, 23, 23),
    Success = Color3.fromRGB(0, 255, 128),
    Error = Color3.fromRGB(255, 0, 0),
    Warning = Color3.fromRGB(255, 128, 0),
    Highlight = Color3.fromRGB(85, 170, 255),
    DarkContrast = Color3.fromRGB(10, 10, 10),
    LightContrast = Color3.fromRGB(40, 40, 40)
}
Library.Themes.Light = {
    Primary = Color3.fromRGB(240, 240, 240),
    Secondary = Color3.fromRGB(250, 250, 250),
    Accent = Color3.fromRGB(0, 120, 215),
    Text = Color3.fromRGB(40, 40, 40),
    TextDark = Color3.fromRGB(75, 75, 75),
    PlaceholderText = Color3.fromRGB(150, 150, 150),
    Background = Color3.fromRGB(255, 255, 255),
    Border = Color3.fromRGB(200, 200, 200),
    WindowBackground = Color3.fromRGB(245, 245, 245),
    TabBackground = Color3.fromRGB(236, 236, 236),
    SectionBackground = Color3.fromRGB(230, 230, 230),
    Success = Color3.fromRGB(0, 180, 90),
    Error = Color3.fromRGB(220, 0, 0),
    Warning = Color3.fromRGB(230, 110, 0),
    Highlight = Color3.fromRGB(0, 120, 215),
    DarkContrast = Color3.fromRGB(220, 220, 220),
    LightContrast = Color3.fromRGB(250, 250, 250)
}
Library.Themes.Discord = {
    Primary = Color3.fromRGB(54, 57, 63),
    Secondary = Color3.fromRGB(47, 49, 54),
    Accent = Color3.fromRGB(114, 137, 218),
    Text = Color3.fromRGB(255, 255, 255),
    TextDark = Color3.fromRGB(185, 187, 190),
    PlaceholderText = Color3.fromRGB(142, 146, 151),
    Background = Color3.fromRGB(41, 43, 47),
    Border = Color3.fromRGB(32, 34, 37),
    WindowBackground = Color3.fromRGB(47, 49, 54),
    TabBackground = Color3.fromRGB(54, 57, 63),
    SectionBackground = Color3.fromRGB(66, 70, 77),
    Success = Color3.fromRGB(67, 181, 129),
    Error = Color3.fromRGB(240, 71, 71),
    Warning = Color3.fromRGB(250, 166, 26),
    Highlight = Color3.fromRGB(114, 137, 218),
    DarkContrast = Color3.fromRGB(30, 31, 34),
    LightContrast = Color3.fromRGB(79, 84, 92)
}
Library.Themes.Midnight = {
    Primary = Color3.fromRGB(26, 32, 58),
    Secondary = Color3.fromRGB(30, 38, 70),
    Accent = Color3.fromRGB(113, 93, 255),
    Text = Color3.fromRGB(255, 255, 255),
    TextDark = Color3.fromRGB(175, 175, 175),
    PlaceholderText = Color3.fromRGB(110, 110, 155),
    Background = Color3.fromRGB(15, 19, 35),
    Border = Color3.fromRGB(20, 24, 45),
    WindowBackground = Color3.fromRGB(20, 25, 45),
    TabBackground = Color3.fromRGB(26, 32, 55),
    SectionBackground = Color3.fromRGB(30, 40, 65),
    Success = Color3.fromRGB(0, 255, 170),
    Error = Color3.fromRGB(255, 53, 87),
    Warning = Color3.fromRGB(255, 161, 0),
    Highlight = Color3.fromRGB(113, 93, 255),
    DarkContrast = Color3.fromRGB(14, 17, 31),
    LightContrast = Color3.fromRGB(42, 53, 94)
}

-- Utility Functions
Library.Utility = {
    -- Create a custom tween
    Tween = function(object, info, properties)
        local anim = TweenService:Create(object, TweenInfo.new(
            info.Time or Library.Settings.TweenSpeed,
            info.Style or Library.Settings.EasingStyle,
            info.Direction or Library.Settings.EasingDirection,
            info.RepeatCount or 0,
            info.Reverses or false,
            info.Delay or 0
        ), properties)
        
        anim:Play()
        return anim
    end,
    
    -- Calculate text size
    TextSize = function(text, fontSize, font, maxSize)
        return TextService:GetTextSize(text, fontSize, font, maxSize or Vector2.new(math.huge, math.huge))
    end,
    
    -- Create a ripple effect
    Ripple = function(parent, posX, posY)
        local ripple = Instance.new("Frame")
        local UICorner = Instance.new("UICorner")
        
        ripple.Name = "Ripple"
        ripple.Parent = parent
        ripple.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        ripple.BackgroundTransparency = 0.8
        ripple.BorderSizePixel = 0
        ripple.Position = UDim2.new(0, posX - 10, 0, posY - 10)
        ripple.Size = UDim2.new(0, 20, 0, 20)
        ripple.ZIndex = parent.ZIndex + 1
        
        UICorner.CornerRadius = UDim.new(1, 0)
        UICorner.Parent = ripple
        
        Library.Utility.Tween(ripple, {Time = 0.5}, {
            Size = UDim2.new(0, parent.AbsoluteSize.X * 1.5, 0, parent.AbsoluteSize.X * 1.5),
            Position = UDim2.new(0, posX - parent.AbsoluteSize.X * 0.75, 0, posY - parent.AbsoluteSize.X * 0.75),
            BackgroundTransparency = 1
        })
        
        task.delay(0.5, function()
            ripple:Destroy()
        end)
    end,
    
    -- Create a shadow effect
    Shadow = function(parent, size, transparency)
        local shadow = Instance.new("ImageLabel")
        shadow.Name = "Shadow"
        shadow.Parent = parent
        shadow.AnchorPoint = Vector2.new(0.5, 0.5)
        shadow.BackgroundTransparency = 1
        shadow.Position = UDim2.new(0.5, 0, 0.5, 0)
        shadow.Size = UDim2.new(1, size or 20, 1, size or 20)
        shadow.Image = "rbxassetid://6014261993"
        shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
        shadow.ImageTransparency = transparency or 0.5
        shadow.ScaleType = Enum.ScaleType.Slice
        shadow.SliceCenter = Rect.new(49, 49, 450, 450)
        shadow.ZIndex = parent.ZIndex - 1
        
        return shadow
    end,
    
    -- Round a number to a specific decimal place
    Round = function(number, decimalPlaces)
        local power = 10 ^ (decimalPlaces or 0)
        return math.floor(number * power + 0.5) / power
    end,
    
    -- Convert RGB to HSV
    RGBtoHSV = function(r, g, b)
        r, g, b = r/255, g/255, b/255
        local max, min = math.max(r, g, b), math.min(r, g, b)
        local h, s, v
        v = max
        
        local d = max - min
        if max == 0 then
            s = 0
        else
            s = d / max
        end
        
        if max == min then
            h = 0
        else
            if max == r then
                h = (g - b) / d
                if g < b then h = h + 6 end
            elseif max == g then
                h = (b - r) / d + 2
            elseif max == b then
                h = (r - g) / d + 4
            end
            h = h / 6
        end
        
        return h, s, v
    end,
    
    -- Convert HSV to RGB
    HSVtoRGB = function(h, s, v)
        local r, g, b
        
        local i = math.floor(h * 6)
        local f = h * 6 - i
        local p = v * (1 - s)
        local q = v * (1 - f * s)
        local t = v * (1 - (1 - f) * s)
        
        i = i % 6
        
        if i == 0 then r, g, b = v, t, p
        elseif i == 1 then r, g, b = q, v, p
        elseif i == 2 then r, g, b = p, v, t
        elseif i == 3 then r, g, b = p, q, v
        elseif i == 4 then r, g, b = t, p, v
        elseif i == 5 then r, g, b = v, p, q
        end
        
        return r * 255, g * 255, b * 255
    end,
    
    -- Check if a point is within a frame
    IsInFrame = function(point, frame)
        local framePos = frame.AbsolutePosition
        local frameSize = frame.AbsoluteSize
        
        return point.X >= framePos.X and point.X <= framePos.X + frameSize.X and
               point.Y >= framePos.Y and point.Y <= framePos.Y + frameSize.Y
    end,
    
    -- Make a frame draggable
    MakeDraggable = function(frame, handle, dragSpeed)
        local dragStartPosition
        local frameStartPosition
        local dragging = false
        local speed = dragSpeed or Library.Settings.DragSpeed
        
        handle = handle or frame
        
        local inputBegan = handle.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or
               input.UserInputType == Enum.UserInputType.Touch then
                dragging = true
                dragStartPosition = input.Position
                frameStartPosition = frame.Position
            end
        end)
        
        local inputChanged = UserInputService.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement or
               input.UserInputType == Enum.UserInputType.Touch then
                if dragging then
                    local delta = input.Position - dragStartPosition
                    local newPosition = UDim2.new(
                        frameStartPosition.X.Scale,
                        frameStartPosition.X.Offset + delta.X * speed,
                        frameStartPosition.Y.Scale,
                        frameStartPosition.Y.Offset + delta.Y * speed
                    )
                    frame.Position = newPosition
                end
            end
        end)
        
        local inputEnded = UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or
               input.UserInputType == Enum.UserInputType.Touch then
                dragging = false
            end
        end)
        
        return {
            Disconnect = function()
                inputBegan:Disconnect()
                inputChanged:Disconnect()
                inputEnded:Disconnect()
            end
        }
    end,
    
    -- Create a tooltip
    CreateTooltip = function(parent, text)
        if not Library.Settings.UseTooltips then return nil end
        
        local tooltip = Instance.new("Frame")
        local background = Instance.new("Frame")
        local UICorner = Instance.new("UICorner")
        local label = Instance.new("TextLabel")
        local arrow = Instance.new("Frame")
        local UICorner2 = Instance.new("UICorner")
        
        tooltip.Name = "Tooltip"
        tooltip.Parent = Library.ScreenGui
        tooltip.BackgroundTransparency = 1
        tooltip.Size = UDim2.new(0, 200, 0, 30)
        tooltip.ZIndex = Library.ZIndexOrder.Tooltip
        tooltip.Visible = false
        
        background.Name = "Background"
        background.Parent = tooltip
        background.BackgroundColor3 = Library.Theme.DarkContrast
        background.BorderSizePixel = 0
        background.Size = UDim2.new(1, 0, 1, 0)
        background.ZIndex = Library.ZIndexOrder.Tooltip
        
        UICorner.CornerRadius = UDim.new(0, 4)
        UICorner.Parent = background
        
        label.Name = "Label"
        label.Parent = background
        label.BackgroundTransparency = 1
        label.Position = UDim2.new(0, 10, 0, 0)
        label.Size = UDim2.new(1, -20, 1, 0)
        label.Font = Library.Fonts.Regular
        label.Text = text
        label.TextColor3 = Library.Theme.Text
        label.TextSize = 14
        label.TextWrapped = true
        label.ZIndex = Library.ZIndexOrder.Tooltip
        
        arrow.Name = "Arrow"
        arrow.Parent = tooltip
        arrow.BackgroundColor3 = Library.Theme.DarkContrast
        arrow.BorderSizePixel = 0
        arrow.Position = UDim2.new(0.5, -8, 1, -1)
        arrow.Size = UDim2.new(0, 16, 0, 8)
        arrow.Rotation = 45
        arrow.ZIndex = Library.ZIndexOrder.Tooltip
        
        UICorner2.CornerRadius = UDim.new(0, 2)
        UICorner2.Parent = arrow
        
        -- Size based on text
        local textSize = Library.Utility.TextSize(text, 14, Library.Fonts.Regular, Vector2.new(180, math.huge))
        tooltip.Size = UDim2.new(0, textSize.X + 20, 0, textSize.Y + 10)
        
        -- Show/hide events
        local hoverBegan = parent.MouseEnter:Connect(function()
            tooltip.Position = UDim2.new(0, Mouse.X - tooltip.AbsoluteSize.X/2, 0, Mouse.Y - tooltip.AbsoluteSize.Y - 15)
            tooltip.Visible = true
        end)
        
        local hoverMoved = parent.MouseMoved:Connect(function()
            tooltip.Position = UDim2.new(0, Mouse.X - tooltip.AbsoluteSize.X/2, 0, Mouse.Y - tooltip.AbsoluteSize.Y - 15)
        end)
        
        local hoverEnded = parent.MouseLeave:Connect(function()
            tooltip.Visible = false
        end)
        
        return {
            SetText = function(newText)
                label.Text = newText
                local newTextSize = Library.Utility.TextSize(newText, 14, Library.Fonts.Regular, Vector2.new(180, math.huge))
                tooltip.Size = UDim2.new(0, newTextSize.X + 20, 0, newTextSize.Y + 10)
            end,
            Destroy = function()
                hoverBegan:Disconnect()
                hoverMoved:Disconnect()
                hoverEnded:Disconnect()
                tooltip:Destroy()
            end
        }
    end,
    
    -- Save config to file
    SaveConfig = function(name)
        local configTable = {}
        
        for flag, value in pairs(Library.Flags) do
            if type(value) == "table" and value.Value ~= nil then
                configTable[flag] = value.Value
            else
                configTable[flag] = value
            end
        end
        
        local json = game:GetService("HttpService"):JSONEncode(configTable)
        writefile("ModernUI/" .. name .. ".json", json)
        
        return true
    end,
    
    -- Load config from file
    LoadConfig = function(name)
        if not isfile("ModernUI/" .. name .. ".json") then
            return false
        end
        
        local success, configTable = pcall(function()
            return game:GetService("HttpService"):JSONDecode(readfile("ModernUI/" .. name .. ".json"))
        end)
        
        if not success then
            return false
        end
        
        for flag, value in pairs(configTable) do
            if Library.Flags[flag] ~= nil then
                if type(Library.Flags[flag]) == "table" and Library.Flags[flag].Set then
                    Library.Flags[flag]:Set(value)
                else
                    Library.Flags[flag] = value
                end
            end
        end
        
        return true
    end
}

-- Initialize the UI
function Library:Init()
    if self.Initialized then return end
    
    -- Create ScreenGui
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = "ModernUI"
    self.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    self.ScreenGui.ResetOnSpawn = false
    self.ScreenGui.IgnoreGuiInset = true
    
    -- Check if we can use CoreGui
    local success, result = pcall(function()
        self.ScreenGui.Parent = CoreGui
        return true
    end)
    
    if not success then
        self.ScreenGui.Parent = Player:WaitForChild("PlayerGui")
    end
    
    -- Create notification container
    self.NotificationContainer = Instance.new("Frame")
    self.NotificationContainer.Name = "NotificationContainer"
    self.NotificationContainer.Parent = self.ScreenGui
    self.NotificationContainer.BackgroundTransparency = 1
    self.NotificationContainer.Position = UDim2.new(1, -20, 0, 20)
    self.NotificationContainer.Size = UDim2.new(0, 300, 1, -40)
    self.NotificationContainer.ZIndex = self.ZIndexOrder.Notification
    
    local UIListLayout = Instance.new("UIListLayout")
    UIListLayout.Parent = self.NotificationContainer
    UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    UIListLayout.Padding = UDim.new(0, 10)
    
    -- Setup close keybind
    UserInputService.InputBegan:Connect(function(input)
        if input.KeyCode == self.Settings.CloseBind then
            self.ScreenGui.Enabled = not self.ScreenGui.Enabled
        end
    end)
    
    self.Initialized = true
    return self
end

-- Change theme
function Library:SetTheme(themeName)
    if self.Themes[themeName] then
        for property, color in pairs(self.Themes[themeName]) do
            self.Theme[property] = color
        end
        
        -- Update existing elements
        for _, object in pairs(self.Objects) do
            if object.ThemeUpdater then
                object.ThemeUpdater()
            end
        end
    end
end

-- Create a notification
function Library:Notify(options)
    if not self.Initialized then self:Init() end
    options = options or {}
    
    local title = options.Title or "Notification"
    local text = options.Text or ""
    local duration = options.Duration or 5
    local type = options.Type or "Info" -- Info, Success, Error, Warning
    
    -- Create notification UI
    local notification = Instance.new("Frame")
    local background = Instance.new("Frame")
    local UICorner = Instance.new("UICorner")
    local titleLabel = Instance.new("TextLabel")
    local textLabel = Instance.new("TextLabel")
    local icon = Instance.new("ImageLabel")
    local closeButton = Instance.new("TextButton")
    local progressBar = Instance.new("Frame")
    
    notification.Name = "Notification"
    notification.Parent = self.NotificationContainer
    notification.BackgroundTransparency = 1
    notification.Size = UDim2.new(1, 0, 0, 80)
    notification.ZIndex = self.ZIndexOrder.Notification
    notification.LayoutOrder = tick()
    
    background.Name = "Background"
    background.Parent = notification
    background.BackgroundColor3 = self.Theme.Secondary
    background.BorderSizePixel = 0
    background.Size = UDim2.new(1, 0, 1, 0)
    background.ZIndex = self.ZIndexOrder.Notification
    
    UICorner.CornerRadius = UDim.new(0, 6)
    UICorner.Parent = background
    
    -- Add shadow
    self.Utility.Shadow(background, 15, 0.5)
    
    titleLabel.Name = "Title"
    titleLabel.Parent = background
    titleLabel.BackgroundTransparency = 1
    titleLabel.Position = UDim2.new(0, 50, 0, 10)
    titleLabel.Size = UDim2.new(1, -70, 0, 20)
    titleLabel.Font = self.Fonts.Bold
    titleLabel.Text = title
    titleLabel.TextColor3 = self.Theme.Text
    titleLabel.TextSize = 16
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.ZIndex = self.ZIndexOrder.Notification
    
    textLabel.Name = "Text"
    textLabel.Parent = background
    textLabel.BackgroundTransparency = 1
    textLabel.Position = UDim2.new(0, 50, 0, 30)
    textLabel.Size = UDim2.new(1, -60, 0, 40)
    textLabel.Font = self.Fonts.Regular
    textLabel.Text = text
    textLabel.TextColor3 = self.Theme.TextDark
    textLabel.TextSize = 14
    textLabel.TextWrapped = true
    textLabel.TextXAlignment = Enum.TextXAlignment.Left
    textLabel.TextYAlignment = Enum.TextYAlignment.Top
    textLabel.ZIndex = self.ZIndexOrder.Notification
    
    icon.Name = "Icon"
    icon.Parent = background
    icon.BackgroundTransparency = 1
    icon.Position = UDim2.new(0, 15, 0, 15)
    icon.Size = UDim2.new(0, 24, 0, 24)
    icon.ZIndex = self.ZIndexOrder.Notification
    
    -- Set icon based on notification type
    if type == "Success" then
        icon.Image = "rbxassetid://6023426926"
        icon.ImageColor3 = self.Theme.Success
    elseif type == "Error" then
        icon.Image = "rbxassetid://6023426926"
        icon.ImageColor3 = self.Theme.Error
    elseif type == "Warning" then
        icon.Image = "rbxassetid://6023426926"
        icon.ImageColor3 = self.Theme.Warning
    else
        icon.Image = "rbxassetid://6023426926"
        icon.ImageColor3 = self.Theme.Accent
    end
    
    closeButton.Name = "CloseButton"
    closeButton.Parent = background
    closeButton.BackgroundTransparency = 1
    closeButton.Position = UDim2.new(1, -25, 0, 10)
    closeButton.Size = UDim2.new(0, 20, 0, 20)
    closeButton.Font = self.Fonts.Regular
    closeButton.Text = "×"
    closeButton.TextColor3 = self.Theme.TextDark
    closeButton.TextSize = 20
    closeButton.ZIndex = self.ZIndexOrder.Notification
    
    progressBar.Name = "ProgressBar"
    progressBar.Parent = background
    progressBar.BackgroundColor3 = self.Theme.Accent
    progressBar.BorderSizePixel = 0
    progressBar.Position = UDim2.new(0, 0, 1, -2)
    progressBar.Size = UDim2.new(1, 0, 0, 2)
    progressBar.ZIndex = self.ZIndexOrder.Notification
    
    -- Animate in
    notification.Position = UDim2.new(1, 20, 0, 0)
    self.Utility.Tween(notification, {Time = 0.5}, {Position = UDim2.new(0, 0, 0, 0)})
    
    -- Progress bar animation
    self.Utility.Tween(progressBar, {Time = duration}, {Size = UDim2.new(0, 0, 0, 2)})
    
    -- Close notification after duration
    local closeTask
    closeTask = task.delay(duration, function()
        self.Utility.Tween(notification, {Time = 0.5}, {Position = UDim2.new(1, 20, 0, 0)})
        task.delay(0.5, function()
            notification:Destroy()
        end)
    end)
    
    -- Close button functionality
    closeButton.MouseButton1Click:Connect(function()
        if closeTask then
            task.cancel(closeTask)
        end
        self.Utility.Tween(notification, {Time = 0.5}, {Position = UDim2.new(1, 20, 0, 0)})
        task.delay(0.5, function()
            notification:Destroy()
        end)
    end)
    
    -- Hover effect on close button
    closeButton.MouseEnter:Connect(function()
        self.Utility.Tween(closeButton, {Time = 0.2}, {TextColor3 = self.Theme.Text})
    end)
    
    closeButton.MouseLeave:Connect(function()
        self.Utility.Tween(closeButton, {Time = 0.2}, {TextColor3 = self.Theme.TextDark})
    end)
    
    return notification
end

-- Create a window
function Library:CreateWindow(options)
    if not self.Initialized then self:Init() end
    options = options or {}
    
    local name = options.Name or "Modern UI"
    local size = options.Size or UDim2.new(0, 600, 0, 400)
    local position = options.Position or UDim2.new(0.5, -size.X.Offset/2, 0.5, -size.Y.Offset/2)
    
    self.Stats.WindowCount = self.Stats.WindowCount + 1
    local windowId = self.Stats.WindowCount
    
    -- Create window UI
    local window = {}
    window.Tabs = {}
    window.TabButtons = {}
    window.ActiveTab = nil
    
    -- Create window frame
    window.Frame = Instance.new("Frame")
    window.Frame.Name = "Window"
    window.Frame.Parent = self.ScreenGui
    window.Frame.BackgroundColor3 = self.Theme.WindowBackground
    window.Frame.BorderSizePixel = 0
    window.Frame.Position = position
    window.Frame.Size = size
    window.Frame.ZIndex = self.ZIndexOrder.Window
    
    -- Shadow effect
    self.Utility.Shadow(window.Frame, 15)
    
    -- Rounded corners
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 6)
    UICorner.Parent = window.Frame
    
    -- Title bar
    window.TitleBar = Instance.new("Frame")
    window.TitleBar.Name = "TitleBar"
    window.TitleBar.Parent = window.Frame
    window.TitleBar.BackgroundColor3 = self.Theme.Primary
    window.TitleBar.BorderSizePixel = 0
    window.TitleBar.Size = UDim2.new(1, 0, 0, 40)
    window.TitleBar.ZIndex = self.ZIndexOrder.Window
    
    local titleBarCorner = Instance.new("UICorner")
    titleBarCorner.CornerRadius = UDim.new(0, 6)
    titleBarCorner.Parent = window.TitleBar
    
    -- Fix corner overlap
    local cornerFix = Instance.new("Frame")
    cornerFix.Name = "CornerFix"
    cornerFix.Parent = window.TitleBar
    cornerFix.BackgroundColor3 = self.Theme.Primary
    cornerFix.BorderSizePixel = 0
    cornerFix.Position = UDim2.new(0, 0, 1, -6)
    cornerFix.Size = UDim2.new(1, 0, 0, 6)
    cornerFix.ZIndex = self.ZIndexOrder.Window
    
    -- Title
    window.Title = Instance.new("TextLabel")
    window.Title.Name = "Title"
    window.Title.Parent = window.TitleBar
    window.Title.BackgroundTransparency = 1
    window.Title.Position = UDim2.new(0, 15, 0, 0)
    window.Title.Size = UDim2.new(1, -130, 1, 0)
    window.Title.Font = self.Fonts.Bold
    window.Title.Text = name
    window.Title.TextColor3 = self.Theme.Text
    window.Title.TextSize = 16
    window.Title.TextXAlignment = Enum.TextXAlignment.Left
    window.Title.ZIndex = self.ZIndexOrder.Window
    
    -- Close button
    window.CloseButton = Instance.new("TextButton")
    window.CloseButton.Name = "CloseButton"
    window.CloseButton.Parent = window.TitleBar
    window.CloseButton.BackgroundTransparency = 1
    window.CloseButton.Position = UDim2.new(1, -40, 0, 0)
    window.CloseButton.Size = UDim2.new(0, 40, 1, 0)
    window.CloseButton.Font = self.Fonts.Regular
    window.CloseButton.Text = "×"
    window.CloseButton.TextColor3 = self.Theme.TextDark
    window.CloseButton.TextSize = 24
    window.CloseButton.ZIndex = self.ZIndexOrder.Window
    
    -- Minimize button
    window.MinimizeButton = Instance.new("TextButton")
    window.MinimizeButton.Name = "MinimizeButton"
    window.MinimizeButton.Parent = window.TitleBar
    window.MinimizeButton.BackgroundTransparency = 1
    window.MinimizeButton.Position = UDim2.new(1, -80, 0, 0)
    window.MinimizeButton.Size = UDim2.new(0, 40, 1, 0)
    window.MinimizeButton.Font = self.Fonts.Regular
    window.MinimizeButton.Text = "−"
    window.MinimizeButton.TextColor3 = self.Theme.TextDark
    window.MinimizeButton.TextSize = 24
    window.MinimizeButton.ZIndex = self.ZIndexOrder.Window
    
    -- Tabs container
    window.TabContainer = Instance.new("Frame")
    window.TabContainer.Name = "TabContainer"
    window.TabContainer.Parent = window.Frame
    window.TabContainer.BackgroundColor3 = self.Theme.TabBackground
    window.TabContainer.BorderSizePixel = 0
    window.TabContainer.Position = UDim2.new(0, 0, 0, 40)
    window.TabContainer.Size = UDim2.new(0, 150, 1, -40)
    window.TabContainer.ZIndex = self.ZIndexOrder.Tab
    
    local tabContainerCorner = Instance.new("UICorner")
    tabContainerCorner.CornerRadius = UDim.new(0, 6)
    tabContainerCorner.Parent = window.TabContainer
    
    -- Fix corner overlap
    local cornerFix2 = Instance.new("Frame")
    cornerFix2.Name = "CornerFix"
    cornerFix2.Parent = window.TabContainer
    cornerFix2.BackgroundColor3 = self.Theme.TabBackground
    cornerFix2.BorderSizePixel = 0
    cornerFix2.Position = UDim2.new(0, 0, 0, 0)
    cornerFix2.Size = UDim2.new(1, 0, 0, 6)
    cornerFix2.ZIndex = self.ZIndexOrder.Tab
    
    -- Tab scroll
    window.TabScroll = Instance.new("ScrollingFrame")
    window.TabScroll.Name = "TabScroll"
    window.TabScroll.Parent = window.TabContainer
    window.TabScroll.Active = true
    window.TabScroll.BackgroundTransparency = 1
    window.TabScroll.BorderSizePixel = 0
    window.TabScroll.Position = UDim2.new(0, 0, 0, 6)
    window.TabScroll.Size = UDim2.new(1, 0, 1, -6)
    window.TabScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    window.TabScroll.ScrollBarThickness = 2
    window.TabScroll.ScrollBarImageColor3 = self.Theme.Accent
    window.TabScroll.ZIndex = self.ZIndexOrder.Tab
    
    local tabListLayout = Instance.new("UIListLayout")
    tabListLayout.Parent = window.TabScroll
    tabListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    tabListLayout.Padding = UDim.new(0, 5)
    
    local tabPadding = Instance.new("UIPadding")
    tabPadding.Parent = window.TabScroll
    tabPadding.PaddingTop = UDim.new(0, 5)
    tabPadding.PaddingLeft = UDim.new(0, 5)
    tabPadding.PaddingRight = UDim.new(0, 5)
    
    -- Content container
    window.ContentContainer = Instance.new("Frame")
    window.ContentContainer.Name = "ContentContainer"
    window.ContentContainer.Parent = window.Frame
    window.ContentContainer.BackgroundTransparency = 1
    window.ContentContainer.BorderSizePixel = 0
    window.ContentContainer.Position = UDim2.new(0, 150, 0, 40)
    window.ContentContainer.Size = UDim2.new(1, -150, 1, -40)
    window.ContentContainer.ZIndex = self.ZIndexOrder.Tab
    
    -- Window functionality
    
    -- Make window draggable
    self.Utility.MakeDraggable(window.Frame, window.TitleBar)
    
    -- Close button functionality
    window.CloseButton.MouseButton1Click:Connect(function()
        self.Utility.Tween(window.Frame, {Time = 0.2}, {
            Position = UDim2.new(window.Frame.Position.X.Scale, window.Frame.Position.X.Offset, 1.5, 0)
        })
        task.delay(0.2, function()
            window.Frame:Destroy()
        end)
    end)
    
    -- Close button hover effect
    window.CloseButton.MouseEnter:Connect(function()
        self.Utility.Tween(window.CloseButton, {Time = 0.2}, {TextColor3 = self.Theme.Text})
    end)
    
    window.CloseButton.MouseLeave:Connect(function()
        self.Utility.Tween(window.CloseButton, {Time = 0.2}, {TextColor3 = self.Theme.TextDark})
    end)
    
    -- Minimize button functionality
    local minimized = false
    local originalSize = window.Frame.Size
    
    window.MinimizeButton.MouseButton1Click:Connect(function()
        minimized = not minimized
        
        if minimized then
            self.Utility.Tween(window.Frame, {Time = 0.2}, {Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset, 0, 40)})
            window.MinimizeButton.Text = "+"
        else
            self.Utility.Tween(window.Frame, {Time = 0.2}, {Size = originalSize})
            window.MinimizeButton.Text = "−"
        end
    end)
    
    -- Minimize button hover effect
    window.MinimizeButton.MouseEnter:Connect(function()
        self.Utility.Tween(window.MinimizeButton, {Time = 0.2}, {TextColor3 = self.Theme.Text})
    end)
    
    window.MinimizeButton.MouseLeave:Connect(function()
        self.Utility.Tween(window.MinimizeButton, {Time = 0.2}, {TextColor3 = self.Theme.TextDark})
    end)
    
    -- Dynamic tab list size
    tabListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        window.TabScroll.CanvasSize = UDim2.new(0, 0, 0, tabListLayout.AbsoluteContentSize.Y + 10)
    end)
    
    -- Add tab creation function to window
    function window:AddTab(tabOptions)
        tabOptions = tabOptions or {}
        local tabName = tabOptions.Name or "Tab"
        local tabIcon = tabOptions.Icon or nil
        
        self.Tabs[tabName] = {}
        local tab = self.Tabs[tabName]
        tab.Sections = {}
        
        Library.Stats.TabCount = Library.Stats.TabCount + 1
        local tabId = Library.Stats.TabCount
        
        -- Create tab button
        tab.Button = Instance.new("TextButton")
        tab.Button.Name = tabName .. "Button"
        tab.Button.Parent = self.TabScroll
        tab.Button.BackgroundColor3 = Library.Theme.Secondary
        tab.Button.BorderSizePixel = 0
        tab.Button.Size = UDim2.new(1, 0, 0, 40)
        tab.Button.Font = Library.Fonts.Regular
        tab.Button.Text = ""
        tab.Button.ZIndex = Library.ZIndexOrder.Tab
        
        local tabButtonCorner = Instance.new("UICorner")
        tabButtonCorner.CornerRadius = UDim.new(0, 4)
        tabButtonCorner.Parent = tab.Button
        
        -- Icon (if provided)
        if tabIcon then
            tab.Icon = Instance.new("ImageLabel")
            tab.Icon.Name = "Icon"
            tab.Icon.Parent = tab.Button
            tab.Icon.BackgroundTransparency = 1
            tab.Icon.Position = UDim2.new(0, 10, 0, 10)
            tab.Icon.Size = UDim2.new(0, 20, 0, 20)
            tab.Icon.Image = tabIcon
            tab.Icon.ImageColor3 = Library.Theme.TextDark
            tab.Icon.ZIndex = Library.ZIndexOrder.Tab
            
            tab.Title = Instance.new("TextLabel")
            tab.Title.Name = "Title"
            tab.Title.Parent = tab.Button
            tab.Title.BackgroundTransparency = 1
            tab.Title.Position = UDim2.new(0, 40, 0, 0)
            tab.Title.Size = UDim2.new(1, -50, 1, 0)
            tab.Title.Font = Library.Fonts.Regular
            tab.Title.Text = tabName
            tab.Title.TextColor3 = Library.Theme.TextDark
            tab.Title.TextSize = 14
            tab.Title.TextXAlignment = Enum.TextXAlignment.Left
            tab.Title.ZIndex = Library.ZIndexOrder.Tab
        else
            tab.Title = Instance.new("TextLabel")
            tab.Title.Name = "Title"
            tab.Title.Parent = tab.Button
            tab.Title.BackgroundTransparency = 1
            tab.Title.Position = UDim2.new(0, 10, 0, 0)
            tab.Title.Size = UDim2.new(1, -20, 1, 0)
            tab.Title.Font = Library.Fonts.Regular
            tab.Title.Text = tabName
            tab.Title.TextColor3 = Library.Theme.TextDark
            tab.Title.TextSize = 14
            tab.Title.TextXAlignment = Enum.TextXAlignment.Left
            tab.Title.ZIndex = Library.ZIndexOrder.Tab
        end
        
        -- Active indicator
        tab.ActiveIndicator = Instance.new("Frame")
        tab.ActiveIndicator.Name = "ActiveIndicator"
        tab.ActiveIndicator.Parent = tab.Button
        tab.ActiveIndicator.BackgroundColor3 = Library.Theme.Accent
        tab.ActiveIndicator.BorderSizePixel = 0
        tab.ActiveIndicator.Position = UDim2.new(0, 0, 0, 0)
        tab.ActiveIndicator.Size = UDim2.new(0, 3, 1, 0)
        tab.ActiveIndicator.Visible = false
        tab.ActiveIndicator.ZIndex = Library.ZIndexOrder.Tab
        
        local activeIndicatorCorner = Instance.new("UICorner")
        activeIndicatorCorner.CornerRadius = UDim.new(0, 2)
        activeIndicatorCorner.Parent = tab.ActiveIndicator
        
        -- Create tab content container
        tab.Container = Instance.new("ScrollingFrame")
        tab.Container.Name = tabName .. "Container"
        tab.Container.Parent = self.ContentContainer
        tab.Container.BackgroundTransparency = 1
        tab.Container.BorderSizePixel = 0
        tab.Container.Position = UDim2.new(0, 0, 0, 0)
        tab.Container.Size = UDim2.new(1, 0, 1, 0)
        tab.Container.CanvasSize = UDim2.new(0, 0, 0, 0)
        tab.Container.ScrollBarThickness = 4
        tab.Container.ScrollBarImageColor3 = Library.Theme.Accent
        tab.Container.Visible = false
        tab.Container.ZIndex = Library.ZIndexOrder.Tab
        
        local contentListLayout = Instance.new("UIListLayout")
        contentListLayout.Parent = tab.Container
        contentListLayout.SortOrder = Enum.SortOrder.LayoutOrder
        contentListLayout.Padding = UDim.new(0, 10)
        
        local contentPadding = Instance.new("UIPadding")
        contentPadding.Parent = tab.Container
        contentPadding.PaddingTop = UDim.new(0, 10)
        contentPadding.PaddingLeft = UDim.new(0, 10)
        contentPadding.PaddingRight = UDim.new(0, 10)
        contentPadding.PaddingBottom = UDim.new(0, 10)
        
        -- Dynamic content size
        contentListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            tab.Container.CanvasSize = UDim2.new(0, 0, 0, contentListLayout.AbsoluteContentSize.Y + 20)
        end)
        
        -- Button hover effect
        tab.Button.MouseEnter:Connect(function()
            if self.ActiveTab ~= tabName then
                Library.Utility.Tween(tab.Button, {Time = 0.2}, {BackgroundColor3 = Library.Theme.LightContrast})
                
                if tabIcon then
                    Library.Utility.Tween(tab.Icon, {Time = 0.2}, {ImageColor3 = Library.Theme.Text})
                end
                
                Library.Utility.Tween(tab.Title, {Time = 0.2}, {TextColor3 = Library.Theme.Text})
            end
        end)
        
        tab.Button.MouseLeave:Connect(function()
            if self.ActiveTab ~= tabName then
                Library.Utility.Tween(tab.Button, {Time = 0.2}, {BackgroundColor3 = Library.Theme.Secondary})
                
                if tabIcon then
                    Library.Utility.Tween(tab.Icon, {Time = 0.2}, {ImageColor3 = Library.Theme.TextDark})
                end
                
                Library.Utility.Tween(tab.Title, {Time = 0.2}, {TextColor3 = Library.Theme.TextDark})
            end
        end)
        
        -- Button click effect
        tab.Button.MouseButton1Down:Connect(function()
            Library.Utility.Tween(tab.Button, {Time = 0.1}, {BackgroundColor3 = Library.Theme.DarkContrast})
        end)
        
        tab.Button.MouseButton1Up:Connect(function()
            if self.ActiveTab ~= tabName then
                Library.Utility.Tween(tab.Button, {Time = 0.1}, {BackgroundColor3 = Library.Theme.LightContrast})
            end
        end)
        
        -- Tab switching
        tab.Button.MouseButton1Click:Connect(function()
            self:SelectTab(tabName)
        end)
        
        -- Add section creation function to tab
        function tab:AddSection(sectionOptions)
            sectionOptions = sectionOptions or {}
            local sectionName = sectionOptions.Name or "Section"
            
            self.Sections[sectionName] = {}
            local section = self.Sections[sectionName]
            section.Elements = {}
            
            Library.Stats.SectionCount = Library.Stats.SectionCount + 1
            local sectionId = Library.Stats.SectionCount
            
            -- Create section container
            section.Container = Instance.new("Frame")
            section.Container.Name = sectionName .. "Section"
            section.Container.Parent = self.Container
            section.Container.BackgroundColor3 = Library.Theme.SectionBackground
            section.Container.BorderSizePixel = 0
            section.Container.Size = UDim2.new(1, 0, 0, 40) -- Will be resized dynamically
            section.Container.ZIndex = Library.ZIndexOrder.Section
            
            local sectionCorner = Instance.new("UICorner")
            sectionCorner.CornerRadius = UDim.new(0, 6)
            sectionCorner.Parent = section.Container
            
            -- Section title
            section.Title = Instance.new("TextLabel")
            section.Title.Name = "SectionTitle"
            section.Title.Parent = section.Container
            section.Title.BackgroundTransparency = 1
            section.Title.Position = UDim2.new(0, 15, 0, 0)
            section.Title.Size = UDim2.new(1, -30, 0, 40)
            section.Title.Font = Library.Fonts.Semibold
            section.Title.Text = sectionName
            section.Title.TextColor3 = Library.Theme.Text
            section.Title.TextSize = 16
            section.Title.TextXAlignment = Enum.TextXAlignment.Left
            section.Title.ZIndex = Library.ZIndexOrder.Section
            
            -- Section content container
            section.Content = Instance.new("Frame")
            section.Content.Name = "SectionContent"
            section.Content.Parent = section.Container
            section.Content.BackgroundTransparency = 1
            section.Content.BorderSizePixel = 0
            section.Content.Position = UDim2.new(0, 0, 0, 40)
            section.Content.Size = UDim2.new(1, 0, 0, 0) -- Will be resized dynamically
            section.Content.ZIndex = Library.ZIndexOrder.Section
            
            local contentListLayout = Instance.new("UIListLayout")
            contentListLayout.Parent = section.Content
            contentListLayout.SortOrder = Enum.SortOrder.LayoutOrder
            contentListLayout.Padding = UDim.new(0, 10)
            
            local contentPadding = Instance.new("UIPadding")
            contentPadding.Parent = section.Content
            contentPadding.PaddingLeft = UDim.new(0, 15)
            contentPadding.PaddingRight = UDim.new(0, 15)
            contentPadding.PaddingBottom = UDim.new(0, 15)
            
            -- Dynamically resize section based on content
            contentListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                section.Content.Size = UDim2.new(1, 0, 0, contentListLayout.AbsoluteContentSize.Y + 15)
                section.Container.Size = UDim2.new(1, 0, 0, 40 + section.Content.Size.Y.Offset)
            end)
            
            -- Add button creation function to section
            function section:AddButton(options)
                options = options or {}
                local buttonName = options.Name or "Button"
                local callback = options.Callback or function() end
                
                Library.Stats.ElementCount = Library.Stats.ElementCount + 1
                local elementId = Library.Stats.ElementCount
                
                -- Create button element
                local button = {}
                self.Elements[buttonName] = button
                
                button.Container = Instance.new("Frame")
                button.Container.Name = buttonName .. "Button"
                button.Container.Parent = self.Content
                button.Container.BackgroundTransparency = 1
                button.Container.Size = UDim2.new(1, 0, 0, 35)
                button.Container.ZIndex = Library.ZIndexOrder.Element
                
                button.Button = Instance.new("TextButton")
                button.Button.Name = "Button"
                button.Button.Parent = button.Container
                button.Button.BackgroundColor3 = Library.Theme.Secondary
                button.Button.BorderSizePixel = 0
                button.Button.Position = UDim2.new(0, 0, 0, 0)
                button.Button.Size = UDim2.new(1, 0, 1, 0)
                button.Button.Font = Library.Fonts.Regular
                button.Button.Text = ""
                button.Button.ZIndex = Library.ZIndexOrder.Element
                
                local buttonCorner = Instance.new("UICorner")
                buttonCorner.CornerRadius = UDim.new(0, 4)
                buttonCorner.Parent = button.Button
                
                button.Title = Instance.new("TextLabel")
                button.Title.Name = "Title"
                button.Title.Parent = button.Button
                button.Title.BackgroundTransparency = 1
                button.Title.Position = UDim2.new(0, 15, 0, 0)
                button.Title.Size = UDim2.new(1, -30, 1, 0)
                button.Title.Font = Library.Fonts.Regular
                button.Title.Text = buttonName
                button.Title.TextColor3 = Library.Theme.Text
                button.Title.TextSize = 14
                button.Title.TextXAlignment = Enum.TextXAlignment.Left
                button.Title.ZIndex = Library.ZIndexOrder.Element
                
                -- Button hover effect
                button.Button.MouseEnter:Connect(function()
                    Library.Utility.Tween(button.Button, {Time = 0.2}, {BackgroundColor3 = Library.Theme.LightContrast})
                end)
                
                button.Button.MouseLeave:Connect(function()
                    Library.Utility.Tween(button.Button, {Time = 0.2}, {BackgroundColor3 = Library.Theme.Secondary})
                end)
                
                -- Button click effect
                button.Button.MouseButton1Down:Connect(function()
                    Library.Utility.Tween(button.Button, {Time = 0.1}, {BackgroundColor3 = Library.Theme.DarkContrast})
                end)
                
                button.Button.MouseButton1Up:Connect(function()
                    Library.Utility.Tween(button.Button, {Time = 0.1}, {BackgroundColor3 = Library.Theme.LightContrast})
                end)
                
                -- Ripple effect
                button.Button.MouseButton1Click:Connect(function()
                    local mousePos = UserInputService:GetMouseLocation()
                    local buttonPos = button.Button.AbsolutePosition
                    local clickPos = Vector2.new(mousePos.X - buttonPos.X, mousePos.Y - buttonPos.Y)
                    
                    Library.Utility.Ripple(button.Button, clickPos.X, clickPos.Y)
                    
                    callback()
                end)
                
                -- Create tooltip if specified
                if options.Tooltip then
                    button.Tooltip = Library.Utility.CreateTooltip(button.Button, options.Tooltip)
                end
                
                return button
            end
            
            -- Add toggle creation function to section
            function section:AddToggle(options)
                options = options or {}
                local toggleName = options.Name or "Toggle"
                local default = options.Default or false
                local callback = options.Callback or function() end
                local flag = options.Flag or (toggleName .. elementId .. "Toggle")
                
                Library.Stats.ElementCount = Library.Stats.ElementCount + 1
                local elementId = Library.Stats.ElementCount
                
                -- Create toggle element
                local toggle = {}
                self.Elements[toggleName] = toggle
                
                toggle.Value = default
                toggle.Container = Instance.new("Frame")
                toggle.Container.Name = toggleName .. "Toggle"
                toggle.Container.Parent = self.Content
                toggle.Container.BackgroundTransparency = 1
                toggle.Container.Size = UDim2.new(1, 0, 0, 35)
                toggle.Container.ZIndex = Library.ZIndexOrder.Element
                
                toggle.Button = Instance.new("TextButton")
                toggle.Button.Name = "Button"
                toggle.Button.Parent = toggle.Container
                toggle.Button.BackgroundTransparency = 1
                toggle.Button.Size = UDim2.new(1, 0, 1, 0)
                toggle.Button.Text = ""
                toggle.Button.ZIndex = Library.ZIndexOrder.Element
                
                toggle.Title = Instance.new("TextLabel")
                toggle.Title.Name = "Title"
                toggle.Title.Parent = toggle.Container
                toggle.Title.BackgroundTransparency = 1
                toggle.Title.Position = UDim2.new(0, 0, 0, 0)
                toggle.Title.Size = UDim2.new(1, -50, 1, 0)
                toggle.Title.Font = Library.Fonts.Regular
                toggle.Title.Text = toggleName
                toggle.Title.TextColor3 = Library.Theme.Text
                toggle.Title.TextSize = 14
                toggle.Title.TextXAlignment = Enum.TextXAlignment.Left
                toggle.Title.ZIndex = Library.ZIndexOrder.Element
                
                toggle.Switch = Instance.new("Frame")
                toggle.Switch.Name = "Switch"
                toggle.Switch.Parent = toggle.Container
                toggle.Switch.BackgroundColor3 = Library.Theme.Secondary
                toggle.Switch.BorderSizePixel = 0
                toggle.Switch.Position = UDim2.new(1, -40, 0.5, -8)
                toggle.Switch.Size = UDim2.new(0, 40, 0, 16)
                toggle.Switch.ZIndex = Library.ZIndexOrder.Element
                
                local switchCorner = Instance.new("UICorner")
                switchCorner.CornerRadius = UDim.new(1, 0)
                switchCorner.Parent = toggle.Switch
                
                toggle.Indicator = Instance.new("Frame")
                toggle.Indicator.Name = "Indicator"
                toggle.Indicator.Parent = toggle.Switch
                toggle.Indicator.BackgroundColor3 = Library.Theme.TextDark
                toggle.Indicator.BorderSizePixel = 0
                toggle.Indicator.Position = UDim2.new(0, 2, 0.5, -6)
                toggle.Indicator.Size = UDim2.new(0, 12, 0, 12)
                toggle.Indicator.ZIndex = Library.ZIndexOrder.Element
                
                local indicatorCorner = Instance.new("UICorner")
                indicatorCorner.CornerRadius = UDim.new(1, 0)
                indicatorCorner.Parent = toggle.Indicator
                
                -- Set up the toggle functionality
                function toggle:Set(value)
                    self.Value = value
                    Library.Flags[flag] = value
                    
                    if value then
                        Library.Utility.Tween(self.Switch, {Time = 0.2}, {BackgroundColor3 = Library.Theme.Accent})
                        Library.Utility.Tween(self.Indicator, {Time = 0.2}, {
                            Position = UDim2.new(1, -14, 0.5, -6),
                            BackgroundColor3 = Library.Theme.Text
                        })
                    else
                        Library.Utility.Tween(self.Switch, {Time = 0.2}, {BackgroundColor3 = Library.Theme.Secondary})
                        Library.Utility.Tween(self.Indicator, {Time = 0.2}, {
                            Position = UDim2.new(0, 2, 0.5, -6),
                            BackgroundColor3 = Library.Theme.TextDark
                        })
                    end
                    
                    callback(value)
                end
                
                -- Set initial state
                toggle:Set(default)
                
                -- Toggle click handler
                toggle.Button.MouseButton1Click:Connect(function()
                    toggle:Set(not toggle.Value)
                end)
                
                -- Hover effect
                toggle.Button.MouseEnter:Connect(function()
                    Library.Utility.Tween(toggle.Title, {Time = 0.2}, {TextColor3 = Library.Theme.Accent})
                end)
                
                toggle.Button.MouseLeave:Connect(function()
                    Library.Utility.Tween(toggle.Title, {Time = 0.2}, {TextColor3 = Library.Theme.Text})
                end)
                
                -- Create tooltip if specified
                if options.Tooltip then
                    toggle.Tooltip = Library.Utility.CreateTooltip(toggle.Container, options.Tooltip)
                end
                
                -- Register flag
                Library.Flags[flag] = {
                    Value = default,
                    Set = function(value)
                        toggle:Set(value)
                    end
                }
                
                return toggle
            end
            
            -- Add slider creation function to section
            function section:AddSlider(options)
                options = options or {}
                local sliderName = options.Name or "Slider"
                local min = options.Min or 0
                local max = options.Max or 100
                local default = options.Default or min
                local increment = options.Increment or 1
                local valueLabel = options.ValueLabel or false
                local callback = options.Callback or function() end
                local flag = options.Flag or (sliderName .. elementId .. "Slider")
                
                Library.Stats.ElementCount = Library.Stats.ElementCount + 1
                local elementId = Library.Stats.ElementCount
                
                -- Check default value is within range
                default = math.clamp(default, min, max)
                
                -- Create slider element
                local slider = {}
                self.Elements[sliderName] = slider
                
                slider.Value = default
                slider.Min = min
                slider.Max = max
                slider.Increment = increment
                
                slider.Container = Instance.new("Frame")
                slider.Container.Name = sliderName .. "Slider"
                slider.Container.Parent = self.Content
                slider.Container.BackgroundTransparency = 1
                slider.Container.Size = UDim2.new(1, 0, 0, 55)
                slider.Container.ZIndex = Library.ZIndexOrder.Element
                
                slider.Title = Instance.new("TextLabel")
                slider.Title.Name = "Title"
                slider.Title.Parent = slider.Container
                slider.Title.BackgroundTransparency = 1
                slider.Title.Position = UDim2.new(0, 0, 0, 0)
                slider.Title.Size = UDim2.new(1, 0, 0, 20)
                slider.Title.Font = Library.Fonts.Regular
                slider.Title.Text = sliderName
                slider.Title.TextColor3 = Library.Theme.Text
                slider.Title.TextSize = 14
                slider.Title.TextXAlignment = Enum.TextXAlignment.Left
                slider.Title.ZIndex = Library.ZIndexOrder.Element
                
                slider.ValueLabel = Instance.new("TextLabel")
                slider.ValueLabel.Name = "ValueLabel"
                slider.ValueLabel.Parent = slider.Container
                slider.ValueLabel.BackgroundTransparency = 1
                slider.ValueLabel.Position = UDim2.new(1, -40, 0, 0)
                slider.ValueLabel.Size = UDim2.new(0, 40, 0, 20)
                slider.ValueLabel.Font = Library.Fonts.Regular
                slider.ValueLabel.Text = tostring(default)
                slider.ValueLabel.TextColor3 = Library.Theme.TextDark
                slider.ValueLabel.TextSize = 14
                slider.ValueLabel.Visible = valueLabel
                slider.ValueLabel.ZIndex = Library.ZIndexOrder.Element
                
                slider.SliderBG = Instance.new("Frame")
                slider.SliderBG.Name = "SliderBG"
                slider.SliderBG.Parent = slider.Container
                slider.SliderBG.BackgroundColor3 = Library.Theme.Secondary
                slider.SliderBG.BorderSizePixel = 0
                slider.SliderBG.Position = UDim2.new(0, 0, 0, 30)
                slider.SliderBG.Size = UDim2.new(1, 0, 0, 5)
                slider.SliderBG.ZIndex = Library.ZIndexOrder.Element
                
                local sliderBGCorner = Instance.new("UICorner")
                sliderBGCorner.CornerRadius = UDim.new(0, 3)
                sliderBGCorner.Parent = slider.SliderBG
                
                slider.SliderFill = Instance.new("Frame")
                slider.SliderFill.Name = "SliderFill"
                slider.SliderFill.Parent = slider.SliderBG
                slider.SliderFill.BackgroundColor3 = Library.Theme.Accent
                slider.SliderFill.BorderSizePixel = 0
                slider.SliderFill.Size = UDim2.new(0, 0, 1, 0)
                slider.SliderFill.ZIndex = Library.ZIndexOrder.Element
                
                local sliderFillCorner = Instance.new("UICorner")
                sliderFillCorner.CornerRadius = UDim.new(0, 3)
                sliderFillCorner.Parent = slider.SliderFill
                
                slider.SliderButton = Instance.new("TextButton")
                slider.SliderButton.Name = "SliderButton"
                slider.SliderButton.Parent = slider.SliderBG
                slider.SliderButton.BackgroundColor3 = Library.Theme.Text
                slider.SliderButton.BorderSizePixel = 0
                slider.SliderButton.Position = UDim2.new(0, -6, 0.5, -6)
                slider.SliderButton.Size = UDim2.new(0, 12, 0, 12)
                slider.SliderButton.Text = ""
                slider.SliderButton.ZIndex = Library.ZIndexOrder.Element
                
                local sliderButtonCorner = Instance.new("UICorner")
                sliderButtonCorner.CornerRadius = UDim.new(1, 0)
                sliderButtonCorner.Parent = slider.SliderButton
                
                -- Set up the slider functionality
                function slider:Set(value)
                    value = math.clamp(value, self.Min, self.Max)
                    
                    -- Round to increment
                    local roundedValue = math.floor((value - self.Min) / self.Increment + 0.5) * self.Increment + self.Min
                    roundedValue = Library.Utility.Round(roundedValue, 2)
                    
                    -- Clamp again after rounding
                    roundedValue = math.clamp(roundedValue, self.Min, self.Max)
                    
                    self.Value = roundedValue
                    Library.Flags[flag] = roundedValue
                    
                    if valueLabel then
                        self.ValueLabel.Text = tostring(roundedValue)
                    end
                    
                    -- Calculate position percentage
                    local percent = (roundedValue - self.Min) / (self.Max - self.Min)
                    
                    -- Update UI
                    Library.Utility.Tween(self.SliderFill, {Time = 0.1}, {Size = UDim2.new(percent, 0, 1, 0)})
                    Library.Utility.Tween(self.SliderButton, {Time = 0.1}, {Position = UDim2.new(percent, -6, 0.5, -6)})
                    
                    callback(roundedValue)
                end
                
                -- Set initial state
                slider:Set(default)
                
                -- Slider dragging
                local dragging = false
                
                slider.SliderButton.MouseButton1Down:Connect(function()
                    dragging = true
                end)
                
                slider.SliderBG.MouseButton1Down:Connect(function(input)
                    dragging = true
                    local percent = math.clamp((input.Position.X - slider.SliderBG.AbsolutePosition.X) / slider.SliderBG.AbsoluteSize.X, 0, 1)
                    local value = self.Min + (self.Max - self.Min) * percent
                    slider:Set(value)
                end)
                
                UserInputService.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = false
                    end
                end)
                
                UserInputService.InputChanged:Connect(function(input)
                    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                        local percent = math.clamp((input.Position.X - slider.SliderBG.AbsolutePosition.X) / slider.SliderBG.AbsoluteSize.X, 0, 1)
                        local value = self.Min + (self.Max - self.Min) * percent
                        slider:Set(value)
                    end
                end)
                
                -- Create tooltip if specified
                if options.Tooltip then
                    slider.Tooltip = Library.Utility.CreateTooltip(slider.Container, options.Tooltip)
                end
                
                -- Register flag
                Library.Flags[flag] = {
                    Value = default,
                    Set = function(value)
                        slider:Set(value)
                    end
                }
                
                return slider
            end
            
            -- Add dropdown creation function to section
            function section:AddDropdown(options)
                options = options or {}
                local dropdownName = options.Name or "Dropdown"
                local dropdownOptions = options.Options or {}
                local default = options.Default or (dropdownOptions[1] or "")
                local callback = options.Callback or function() end
                local flag = options.Flag or (dropdownName .. elementId .. "Dropdown")
                local multiSelect = options.MultiSelect or false
                
                Library.Stats.ElementCount = Library.Stats.ElementCount + 1
                local elementId = Library.Stats.ElementCount
                
                -- Create dropdown element
                local dropdown = {}
                self.Elements[dropdownName] = dropdown
                
                dropdown.Value = default
                dropdown.Options = dropdownOptions
                dropdown.MultiSelect = multiSelect
                dropdown.Open = false
                
                if multiSelect then
                    if type(dropdown.Value) ~= "table" then
                        dropdown.Value = {}
                    end
                end
                
                dropdown.Container = Instance.new("Frame")
                dropdown.Container.Name = dropdownName .. "Dropdown"
                dropdown.Container.Parent = self.Content
                dropdown.Container.BackgroundTransparency = 1
                dropdown.Container.Size = UDim2.new(1, 0, 0, 40)
                dropdown.Container.ZIndex = Library.ZIndexOrder.Element
                
                dropdown.Title = Instance.new("TextLabel")
                dropdown.Title.Name = "Title"
                dropdown.Title.Parent = dropdown.Container
                dropdown.Title.BackgroundTransparency = 1
                dropdown.Title.Position = UDim2.new(0, 0, 0, 0)
                dropdown.Title.Size = UDim2.new(1, 0, 0, 20)
                dropdown.Title.Font = Library.Fonts.Regular
                dropdown.Title.Text = dropdownName
                dropdown.Title.TextColor3 = Library.Theme.Text
                dropdown.Title.TextSize = 14
                dropdown.Title.TextXAlignment = Enum.TextXAlignment.Left
                dropdown.Title.ZIndex = Library.ZIndexOrder.Element
                
                dropdown.Button = Instance.new("TextButton")
                dropdown.Button.Name = "Button"
                dropdown.Button.Parent = dropdown.Container
                dropdown.Button.BackgroundColor3 = Library.Theme.Secondary
                dropdown.Button.BorderSizePixel = 0
                dropdown.Button.Position = UDim2.new(0, 0, 0, 20)
                dropdown.Button.Size = UDim2.new(1, 0, 0, 35)
                dropdown.Button.Font = Library.Fonts.Regular
                dropdown.Button.Text = ""
                dropdown.Button.ZIndex = Library.ZIndexOrder.Element
                
                local buttonCorner = Instance.new("UICorner")
                buttonCorner.CornerRadius = UDim.new(0, 4)
                buttonCorner.Parent = dropdown.Button
                
                dropdown.Selected = Instance.new("TextLabel")
                dropdown.Selected.Name = "Selected"
                dropdown.Selected.Parent = dropdown.Button
                dropdown.Selected.BackgroundTransparency = 1
                dropdown.Selected.Position = UDim2.new(0, 15, 0, 0)
                dropdown.Selected.Size = UDim2.new(1, -40, 1, 0)
                dropdown.Selected.Font = Library.Fonts.Regular
                dropdown.Selected.Text = tostring(default)
                dropdown.Selected.TextColor3 = Library.Theme.Text
                dropdown.Selected.TextSize = 14
                dropdown.Selected.TextXAlignment = Enum.TextXAlignment.Left
                dropdown.Selected.TextTruncate = Enum.TextTruncate.AtEnd
                dropdown.Selected.ZIndex = Library.ZIndexOrder.Element
                
                dropdown.Icon = Instance.new("ImageLabel")
                dropdown.Icon.Name = "Icon"
                dropdown.Icon.Parent = dropdown.Button
                dropdown.Icon.BackgroundTransparency = 1
                dropdown.Icon.Position = UDim2.new(1, -30, 0.5, -8)
                dropdown.Icon.Size = UDim2.new(0, 16, 0, 16)
                dropdown.Icon.Image = "rbxassetid://8498270304" -- Dropdown arrow icon
                dropdown.Icon.ImageColor3 = Library.Theme.TextDark
                dropdown.Icon.ZIndex = Library.ZIndexOrder.Element
                
                dropdown.OptionContainer = Instance.new("Frame")
                dropdown.OptionContainer.Name = "OptionContainer"
                dropdown.OptionContainer.Parent = dropdown.Container
                dropdown.OptionContainer.BackgroundColor3 = Library.Theme.Secondary
                dropdown.OptionContainer.BorderSizePixel = 0
                dropdown.OptionContainer.Position = UDim2.new(0, 0, 0, 60)
                dropdown.OptionContainer.Size = UDim2.new(1, 0, 0, 0) -- Size will be set dynamically
                dropdown.OptionContainer.Visible = false
                dropdown.OptionContainer.ZIndex = Library.ZIndexOrder.Dropdown
                dropdown.OptionContainer.ClipsDescendants = true
                
                local optionContainerCorner = Instance.new("UICorner")
                optionContainerCorner.CornerRadius = UDim.new(0, 4)
                optionContainerCorner.Parent = dropdown.OptionContainer
                
                dropdown.OptionList = Instance.new("ScrollingFrame")
                dropdown.OptionList.Name = "OptionList"
                dropdown.OptionList.Parent = dropdown.OptionContainer
                dropdown.OptionList.Active = true
                dropdown.OptionList.BackgroundTransparency = 1
                dropdown.OptionList.BorderSizePixel = 0
                dropdown.OptionList.Size = UDim2.new(1, 0, 1, 0)
                dropdown.OptionList.CanvasSize = UDim2.new(0, 0, 0, 0) -- Will be set dynamically
                dropdown.OptionList.ScrollBarThickness = 4
                dropdown.OptionList.ScrollBarImageColor3 = Library.Theme.Accent
                dropdown.OptionList.ZIndex = Library.ZIndexOrder.Dropdown
                
                local optionListLayout = Instance.new("UIListLayout")
                optionListLayout.Parent = dropdown.OptionList
                optionListLayout.SortOrder = Enum.SortOrder.LayoutOrder
                optionListLayout.Padding = UDim.new(0, 5)
                
                local optionListPadding = Instance.new("UIPadding")
                optionListPadding.Parent = dropdown.OptionList
                optionListPadding.PaddingTop = UDim.new(0, 5)
                optionListPadding.PaddingLeft = UDim.new(0, 5)
                optionListPadding.PaddingRight = UDim.new(0, 5)
                optionListPadding.PaddingBottom = UDim.new(0, 5)
                
                -- Update container size when options change
                optionListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                    dropdown.OptionList.CanvasSize = UDim2.new(0, 0, 0, optionListLayout.AbsoluteContentSize.Y + 10)
                end)
                
                -- Set up the dropdown functionality
                function dropdown:Set(value)
                    if self.MultiSelect then
                        if type(value) ~= "table" then
                            value = {value}
                        end
                        
                        self.Value = value
                        
                        -- Update display text
                        if #value == 0 then
                            self.Selected.Text = "None"
                        elseif #value == 1 then
                            self.Selected.Text = tostring(value[1])
                        else
                            self.Selected.Text = tostring(value[1]) .. " (+" .. (#value - 1) .. ")"
                        end
                        
                        -- Update options in UI
                        for _, optionButton in pairs(self.OptionList:GetChildren()) do
                            if optionButton:IsA("TextButton") then
                                local isSelected = table.find(value, optionButton.Name) ~= nil
                                optionButton.TextColor3 = isSelected and Library.Theme.Accent or Library.Theme.Text
                            end
                        end
                    else
                        self.Value = value
                        self.Selected.Text = tostring(value)
                        
                        -- Update options in UI
                        for _, optionButton in pairs(self.OptionList:GetChildren()) do
                            if optionButton:IsA("TextButton") then
                                optionButton.TextColor3 = (optionButton.Name == tostring(value)) and Library.Theme.Accent or Library.Theme.Text
                            end
                        end
                    end
                    
                    Library.Flags[flag] = self.Value
                    callback(self.Value)
                end
                
                -- Toggle the dropdown
                function dropdown:Toggle()
                    self.Open = not self.Open
                    
                    if self.Open then
                        -- Calculate the height based on number of options (max 150px)
                        local optionHeight = math.min(#self.Options * 30 + 10, 150)
                        
                        -- Expand dropdown
                        self.OptionContainer.Visible = true
                        Library.Utility.Tween(self.OptionContainer, {Time = 0.2}, {Size = UDim2.new(1, 0, 0, optionHeight)})
                        Library.Utility.Tween(self.Icon, {Time = 0.2}, {Rotation = 180})
                        
                        -- Update container size
                        Library.Utility.Tween(self.Container, {Time = 0.2}, {Size = UDim2.new(1, 0, 0, 65 + optionHeight)})
                    else
                        -- Collapse dropdown
                        Library.Utility.Tween(self.OptionContainer, {Time = 0.2}, {Size = UDim2.new(1, 0, 0, 0)})
                        Library.Utility.Tween(self.Icon, {Time = 0.2}, {Rotation = 0})
                        Library.Utility.Tween(self.Container, {Time = 0.2}, {Size = UDim2.new(1, 0, 0, 55)})
                        
                        task.delay(0.2, function()
                            if not self.Open then
                                self.OptionContainer.Visible = false
                            end
                        end)
                    end
                    
                    -- Update section size
                    task.delay(0.2, function()
                        contentListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                            section.Content.Size = UDim2.new(1, 0, 0, contentListLayout.AbsoluteContentSize.Y + 15)
                            section.Container.Size = UDim2.new(1, 0, 0, 40 + section.Content.Size.Y.Offset)
                        end)
                    end)
                end
                
                -- Populate options
                function dropdown:Refresh(newOptions, keepSelection)
                    -- Clear existing options
                    for _, child in pairs(self.OptionList:GetChildren()) do
                        if child:IsA("TextButton") then
                            child:Destroy()
                        end
                    end
                    
                    self.Options = newOptions
                    
                    -- Add new options
                    for i, option in pairs(newOptions) do
                        local optionButton = Instance.new("TextButton")
                        optionButton.Name = tostring(option)
                        optionButton.Parent = self.OptionList
                        optionButton.BackgroundTransparency = 1
                        optionButton.Size = UDim2.new(1, 0, 0, 25)
                        optionButton.Font = Library.Fonts.Regular
                        optionButton.Text = tostring(option)
                        optionButton.TextColor3 = Library.Theme.Text
                        optionButton.TextSize = 14
                        optionButton.TextXAlignment = Enum.TextXAlignment.Left
                        optionButton.ZIndex = Library.ZIndexOrder.Dropdown
                        
                        -- Option click handler
                        optionButton.MouseButton1Click:Connect(function()
                            if self.MultiSelect then
                                local valueTable = self.Value
                                local index = table.find(valueTable, option)
                                
                                if index then
                                    table.remove(valueTable, index)
                                else
                                    table.insert(valueTable, option)
                                end
                                
                                self:Set(valueTable)
                            else
                                self:Set(option)
                                self:Toggle()
                            end
                        end)
                        
                        -- Option hover effect
                        optionButton.MouseEnter:Connect(function()
                            Library.Utility.Tween(optionButton, {Time = 0.2}, {BackgroundTransparency = 0.9, BackgroundColor3 = Library.Theme.Accent})
                        end)
                        
                        optionButton.MouseLeave:Connect(function()
                            Library.Utility.Tween(optionButton, {Time = 0.2}, {BackgroundTransparency = 1})
                        end)
                    end
                    
                    -- Reset selection if not keeping it
                    if not keepSelection then
                        if self.MultiSelect then
                            self:Set({})
                        else
                            self:Set(newOptions[1] or "")
                        end
                    end
                end
                
                -- Set initial options
                dropdown:Refresh(dropdownOptions, true)
                
                -- Set initial value
                dropdown:Set(default)
                
                -- Button click handler
                dropdown.Button.MouseButton1Click:Connect(function()
                    dropdown:Toggle()
                end)
                
                -- Button hover effect
                dropdown.Button.MouseEnter:Connect(function()
                    Library.Utility.Tween(dropdown.Button, {Time = 0.2}, {BackgroundColor3 = Library.Theme.LightContrast})
                end)
                
                dropdown.Button.MouseLeave:Connect(function()
                    Library.Utility.Tween(dropdown.Button, {Time = 0.2}, {BackgroundColor3 = Library.Theme.Secondary})
                end)
                
                -- Create tooltip if specified
                if options.Tooltip then
                    dropdown.Tooltip = Library.Utility.CreateTooltip(dropdown.Container, options.Tooltip)
                end
                
                -- Register flag
                Library.Flags[flag] = {
                    Value = default,
                    Set = function(value)
                        dropdown:Set(value)
                    end
                }
                
                return dropdown
            end
            
            -- Add input field creation function to section
            function section:AddInput(options)
                options = options or {}
                local inputName = options.Name or "Input"
                local default = options.Default or ""
                local placeholder = options.Placeholder or "Enter text..."
                local callback = options.Callback or function() end
                local flag = options.Flag or (inputName .. elementId .. "Input")
                
                Library.Stats.ElementCount = Library.Stats.ElementCount + 1
                local elementId = Library.Stats.ElementCount
                
                -- Create input element
                local input = {}
                self.Elements[inputName] = input
                
                input.Value = default
                
                input.Container = Instance.new("Frame")
                input.Container.Name = inputName .. "Input"
                input.Container.Parent = self.Content
                input.Container.BackgroundTransparency = 1
                input.Container.Size = UDim2.new(1, 0, 0, 55)
                input.Container.ZIndex = Library.ZIndexOrder.Element
                
                input.Title = Instance.new("TextLabel")
                input.Title.Name = "Title"
                input.Title.Parent = input.Container
                input.Title.BackgroundTransparency = 1
                input.Title.Position = UDim2.new(0, 0, 0, 0)
                input.Title.Size = UDim2.new(1, 0, 0, 20)
                input.Title.Font = Library.Fonts.Regular
                input.Title.Text = inputName
                input.Title.TextColor3 = Library.Theme.Text
                input.Title.TextSize = 14
                input.Title.TextXAlignment = Enum.TextXAlignment.Left
                input.Title.ZIndex = Library.ZIndexOrder.Element
                
                input.InputBG = Instance.new("Frame")
                input.InputBG.Name = "InputBG"
                input.InputBG.Parent = input.Container
                input.InputBG.BackgroundColor3 = Library.Theme.Secondary
                input.InputBG.BorderSizePixel = 0
                input.InputBG.Position = UDim2.new(0, 0, 0, 20)
                input.InputBG.Size = UDim2.new(1, 0, 0, 35)
                input.InputBG.ZIndex = Library.ZIndexOrder.Element
                
                local inputBGCorner = Instance.new("UICorner")
                inputBGCorner.CornerRadius = UDim.new(0, 4)
                inputBGCorner.Parent = input.InputBG
                
                input.InputField = Instance.new("TextBox")
                input.InputField.Name = "InputField"
                input.InputField.Parent = input.InputBG
                input.InputField.BackgroundTransparency = 1
                input.InputField.Position = UDim2.new(0, 15, 0, 0)
                input.InputField.Size = UDim2.new(1, -30, 1, 0)
                input.InputField.Font = Library.Fonts.Regular
                input.InputField.Text = default
                input.InputField.PlaceholderText = placeholder
                input.InputField.TextColor3 = Library.Theme.Text
                input.InputField.PlaceholderColor3 = Library.Theme.PlaceholderText
                input.InputField.TextSize = 14
                input.InputField.TextXAlignment = Enum.TextXAlignment.Left
                input.InputField.ClearTextOnFocus = false
                input.InputField.ZIndex = Library.ZIndexOrder.Element
                
                -- Set up the input functionality
                function input:Set(value)
                    self.Value = value
                    self.InputField.Text = value
                    Library.Flags[flag] = value
                    callback(value)
                end
                
                -- Input field focus effect
                input.InputField.Focused:Connect(function()
                    Library.Utility.Tween(input.InputBG, {Time = 0.2}, {BackgroundColor3 = Library.Theme.LightContrast})
                end)
                
                input.InputField.FocusLost:Connect(function(enterPressed)
                    Library.Utility.Tween(input.InputBG, {Time = 0.2}, {BackgroundColor3 = Library.Theme.Secondary})
                    
                    if enterPressed then
                        input:Set(input.InputField.Text)
                    else
                        input.InputField.Text = input.Value
                    end
                end)
                
                -- Create tooltip if specified
                if options.Tooltip then
                    input.Tooltip = Library.Utility.CreateTooltip(input.Container, options.Tooltip)
                end
                
                -- Register flag
                Library.Flags[flag] = {
                    Value = default,
                    Set = function(value)
                        input:Set(value)
                    end
                }
                
                return input
            end
            
            -- Add keybind creation function to section
            function section:AddKeybind(options)
                options = options or {}
                local keybindName = options.Name or "Keybind"
                local default = options.Default or Enum.KeyCode.Unknown
                local callback = options.Callback or function() end
                local flag = options.Flag or (keybindName .. elementId .. "Keybind")
                
                Library.Stats.ElementCount = Library.Stats.ElementCount + 1
                local elementId = Library.Stats.ElementCount
                
                -- Create keybind element
                local keybind = {}
                self.Elements[keybindName] = keybind
                
                keybind.Value = default
                keybind.Listening = false
                
                keybind.Container = Instance.new("Frame")
                keybind.Container.Name = keybindName .. "Keybind"
                keybind.Container.Parent = self.Content
                keybind.Container.BackgroundTransparency = 1
                keybind.Container.Size = UDim2.new(1, 0, 0, 35)
                keybind.Container.ZIndex = Library.ZIndexOrder.Element
                
                keybind.Title = Instance.new("TextLabel")
                keybind.Title.Name = "Title"
                keybind.Title.Parent = keybind.Container
                keybind.Title.BackgroundTransparency = 1
                keybind.Title.Position = UDim2.new(0, 0, 0, 0)
                keybind.Title.Size = UDim2.new(1, -80, 1, 0)
                keybind.Title.Font = Library.Fonts.Regular
                keybind.Title.Text = keybindName
                keybind.Title.TextColor3 = Library.Theme.Text
                keybind.Title.TextSize = 14
                keybind.Title.TextXAlignment = Enum.TextXAlignment.Left
                keybind.Title.ZIndex = Library.ZIndexOrder.Element
                
                keybind.Button = Instance.new("TextButton")
                keybind.Button.Name = "Button"
                keybind.Button.Parent = keybind.Container
                keybind.Button.BackgroundColor3 = Library.Theme.Secondary
                keybind.Button.BorderSizePixel = 0
                keybind.Button.Position = UDim2.new(1, -80, 0, 0)
                keybind.Button.Size = UDim2.new(0, 80, 1, 0)
                keybind.Button.Font = Library.Fonts.Regular
                keybind.Button.Text = keybind.Value.Name
                keybind.Button.TextColor3 = Library.Theme.Text
                keybind.Button.TextSize = 14
                keybind.Button.ZIndex = Library.ZIndexOrder.Element
                
                local buttonCorner = Instance.new("UICorner")
                buttonCorner.CornerRadius = UDim.new(0, 4)
                buttonCorner.Parent = keybind.Button
                
                -- Set up the keybind functionality
                function keybind:Set(value)
                    self.Value = value
                    self.Button.Text = value.Name
                    Library.Flags[flag] = value
                    callback(value)
                end
                
                -- Button click handler
                keybind.Button.MouseButton1Click:Connect(function()
                    if keybind.Listening then return end
                    
                    keybind.Listening = true
                    keybind.Button.Text = "..."
                    
                    local inputConnection
                    inputConnection = UserInputService.InputBegan:Connect(function(input)
                        if input.UserInputType == Enum.UserInputType.Keyboard then
                            keybind:Set(input.KeyCode)
                            keybind.Listening = false
                            inputConnection:Disconnect()
                        end
                    end)
                end)
                
                -- Button hover effect
                keybind.Button.MouseEnter:Connect(function()
                    Library.Utility.Tween(keybind.Button, {Time = 0.2}, {BackgroundColor3 = Library.Theme.LightContrast})
                end)
                
                keybind.Button.MouseLeave:Connect(function()
                    Library.Utility.Tween(keybind.Button, {Time = 0.2}, {BackgroundColor3 = Library.Theme.Secondary})
                end)
                
                -- Create tooltip if specified
                if options.Tooltip then
                    keybind.Tooltip = Library.Utility.CreateTooltip(keybind.Container, options.Tooltip)
                end
                
                -- Register flag
                Library.Flags[flag] = {
                    Value = default,
                    Set = function(value)
                        keybind:Set(value)
                    end
                }
                
                -- Set initial value
                keybind:Set(default)
                
                -- Setup global input detection
                if options.GlobalCallback then
                    local connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
                        if not gameProcessed and input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == keybind.Value then
                            callback(keybind.Value)
                        end
                    end)
                    
                    table.insert(Library.Connections, connection)
                end
                
                return keybind
            end
            
            -- Add label creation function to section
            function section:AddLabel(options)
                options = options or {}
                local labelText = options.Text or "Label"
                local textAlign = options.TextAlign or Enum.TextXAlignment.Left
                
                Library.Stats.ElementCount = Library.Stats.ElementCount + 1
                local elementId = Library.Stats.ElementCount
                
                -- Create label element
                local label = {}
                self.Elements[labelText] = label
                
                label.Container = Instance.new("Frame")
                label.Container.Name = "Label" .. elementId
                label.Container.Parent = self.Content
                label.Container.BackgroundTransparency = 1
                label.Container.Size = UDim2.new(1, 0, 0, 20)
                label.Container.ZIndex = Library.ZIndexOrder.Element
                
                label.Text = Instance.new("TextLabel")
                label.Text.Name = "Text"
                label.Text.Parent = label.Container
                label.Text.BackgroundTransparency = 1
                label.Text.Size = UDim2.new(1, 0, 1, 0)
                label.Text.Font = Library.Fonts.Regular
                label.Text.Text = labelText
                label.Text.TextColor3 = Library.Theme.TextDark
                label.Text.TextSize = 14
                label.Text.TextXAlignment = textAlign
                label.Text.TextWrapped = true
                label.Text.ZIndex = Library.ZIndexOrder.Element
                
                -- Set up the label functionality
                function label:SetText(text)
                    self.Text.Text = text
                end
                
                -- Create tooltip if specified
                if options.Tooltip then
                    label.Tooltip = Library.Utility.CreateTooltip(label.Container, options.Tooltip)
                end
                
                return label
            end
            
            -- Add color picker creation function to section
            function section:AddColorPicker(options)
                options = options or {}
                local colorPickerName = options.Name or "ColorPicker"
                local default = options.Default or Color3.fromRGB(255, 255, 255)
                local callback = options.Callback or function() end
                local flag = options.Flag or (colorPickerName .. elementId .. "ColorPicker")
                
                Library.Stats.ElementCount = Library.Stats.ElementCount + 1
                local elementId = Library.Stats.ElementCount
                
                -- Create color picker element
                local colorPicker = {}
                self.Elements[colorPickerName] = colorPicker
                
                colorPicker.Value = default
                colorPicker.Open = false
                
                colorPicker.Container = Instance.new("Frame")
                colorPicker.Container.Name = colorPickerName .. "ColorPicker"
                colorPicker.Container.Parent = self.Content
                colorPicker.Container.BackgroundTransparency = 1
                colorPicker.Container.Size = UDim2.new(1, 0, 0, 35)
                colorPicker.Container.ZIndex = Library.ZIndexOrder.Element
                
                colorPicker.Title = Instance.new("TextLabel")
                colorPicker.Title.Name = "Title"
                colorPicker.Title.Parent = colorPicker.Container
                colorPicker.Title.BackgroundTransparency = 1
                colorPicker.Title.Position = UDim2.new(0, 0, 0, 0)
                colorPicker.Title.Size = UDim2.new(1, -50, 1, 0)
                colorPicker.Title.Font = Library.Fonts.Regular
                colorPicker.Title.Text = colorPickerName
                colorPicker.Title.TextColor3 = Library.Theme.Text
                colorPicker.Title.TextSize = 14
                colorPicker.Title.TextXAlignment = Enum.TextXAlignment.Left
                colorPicker.Title.ZIndex = Library.ZIndexOrder.Element
                
                colorPicker.Display = Instance.new("Frame")
                colorPicker.Display.Name = "Display"
                colorPicker.Display.Parent = colorPicker.Container
                colorPicker.Display.BackgroundColor3 = default
                colorPicker.Display.BorderSizePixel = 0
                colorPicker.Display.Position = UDim2.new(1, -40, 0.5, -10)
                colorPicker.Display.Size = UDim2.new(0, 40, 0, 20)
                colorPicker.Display.ZIndex = Library.ZIndexOrder.Element
                
                local displayCorner = Instance.new("UICorner")
                displayCorner.CornerRadius = UDim.new(0, 4)
                displayCorner.Parent = colorPicker.Display
                
                colorPicker.Button = Instance.new("TextButton")
                colorPicker.Button.Name = "Button"
                colorPicker.Button.Parent = colorPicker.Display
                colorPicker.Button.BackgroundTransparency = 1
                colorPicker.Button.Size = UDim2.new(1, 0, 1, 0)
                colorPicker.Button.Font = Library.Fonts.Regular
                colorPicker.Button.Text = ""
                colorPicker.Button.ZIndex = Library.ZIndexOrder.Element
                
                -- Create color picker UI
                colorPicker.Picker = Instance.new("Frame")
                colorPicker.Picker.Name = "Picker"
                colorPicker.Picker.Parent = colorPicker.Container
                colorPicker.Picker.BackgroundColor3 = Library.Theme.Secondary
                colorPicker.Picker.BorderSizePixel = 0
                colorPicker.Picker.Position = UDim2.new(0, 0, 0, 40)
                colorPicker.Picker.Size = UDim2.new(1, 0, 0, 200)
                colorPicker.Picker.Visible = false
                colorPicker.Picker.ZIndex = Library.ZIndexOrder.Colorpicker
                
                local pickerCorner = Instance.new("UICorner")
                pickerCorner.CornerRadius = UDim.new(0, 4)
                pickerCorner.Parent = colorPicker.Picker
                
                -- Create color wheel
                colorPicker.ColorWheel = Instance.new("ImageLabel")
                colorPicker.ColorWheel.Name = "ColorWheel"
                colorPicker.ColorWheel.Parent = colorPicker.Picker
                colorPicker.ColorWheel.BackgroundTransparency = 1
                colorPicker.ColorWheel.Position = UDim2.new(0, 10, 0, 10)
                colorPicker.ColorWheel.Size = UDim2.new(0, 150, 0, 150)
                colorPicker.ColorWheel.Image = "rbxassetid://6020299385"
                colorPicker.ColorWheel.ZIndex = Library.ZIndexOrder.Colorpicker
                
                colorPicker.ColorWheelSelector = Instance.new("Frame")
                colorPicker.ColorWheelSelector.Name = "Selector"
                colorPicker.ColorWheelSelector.Parent = colorPicker.ColorWheel
                colorPicker.ColorWheelSelector.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                colorPicker.ColorWheelSelector.BorderSizePixel = 0
                colorPicker.ColorWheelSelector.Position = UDim2.new(0.5, -4, 0.5, -4)
                colorPicker.ColorWheelSelector.Size = UDim2.new(0, 8, 0, 8)
                colorPicker.ColorWheelSelector.ZIndex = Library.ZIndexOrder.Colorpicker
                
                local colorWheelSelectorCorner = Instance.new("UICorner")
                colorWheelSelectorCorner.CornerRadius = UDim.new(1, 0)
                colorWheelSelectorCorner.Parent = colorPicker.ColorWheelSelector
                
                -- Create brightness slider
                colorPicker.BrightnessSlider = Instance.new("Frame")
                colorPicker.BrightnessSlider.Name = "BrightnessSlider"
                colorPicker.BrightnessSlider.Parent = colorPicker.Picker
                colorPicker.BrightnessSlider.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                colorPicker.BrightnessSlider.BorderSizePixel = 0
                colorPicker.BrightnessSlider.Position = UDim2.new(0, 170, 0, 10)
                colorPicker.BrightnessSlider.Size = UDim2.new(0, 20, 0, 150)
                colorPicker.BrightnessSlider.ZIndex = Library.ZIndexOrder.Colorpicker
                
                local brightnessSliderCorner = Instance.new("UICorner")
                brightnessSliderCorner.CornerRadius = UDim.new(0, 4)
                brightnessSliderCorner.Parent = colorPicker.BrightnessSlider
                
                colorPicker.BrightnessSliderGradient = Instance.new("UIGradient")
                colorPicker.BrightnessSliderGradient.Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 0, 0)),
                    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
                })
                colorPicker.BrightnessSliderGradient.Rotation = 90
                colorPicker.BrightnessSliderGradient.Parent = colorPicker.BrightnessSlider
                
                colorPicker.BrightnessSliderSelector = Instance.new("Frame")
                colorPicker.BrightnessSliderSelector.Name = "Selector"
                colorPicker.BrightnessSliderSelector.Parent = colorPicker.BrightnessSlider
                colorPicker.BrightnessSliderSelector.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                colorPicker.BrightnessSliderSelector.BorderSizePixel = 0
                colorPicker.BrightnessSliderSelector.Position = UDim2.new(0, -2, 1, -4)
                colorPicker.BrightnessSliderSelector.Size = UDim2.new(0, 24, 0, 8)
                colorPicker.BrightnessSliderSelector.ZIndex = Library.ZIndexOrder.Colorpicker
                
                local brightnessSliderSelectorCorner = Instance.new("UICorner")
                brightnessSliderSelectorCorner.CornerRadius = UDim.new(0, 2)
                brightnessSliderSelectorCorner.Parent = colorPicker.BrightnessSliderSelector
                
                -- RGB and hex inputs
                colorPicker.RgbInputs = {}
                
                for i, color in pairs({"R", "G", "B"}) do
                    colorPicker.RgbInputs[color] = Instance.new("Frame")
                    colorPicker.RgbInputs[color].Name = color
                    colorPicker.RgbInputs[color].Parent = colorPicker.Picker
                    colorPicker.RgbInputs[color].BackgroundColor3 = Library.Theme.Secondary
                    colorPicker.RgbInputs[color].BorderSizePixel = 0
                    colorPicker.RgbInputs[color].Position = UDim2.new(0, 10 + (i-1) * 63, 0, 170)
                    colorPicker.RgbInputs[color].Size = UDim2.new(0, 55, 0, 20)
                    colorPicker.RgbInputs[color].ZIndex = Library.ZIndexOrder.Colorpicker
                    
                    local rgbCorner = Instance.new("UICorner")
                    rgbCorner.CornerRadius = UDim.new(0, 2)
                    rgbCorner.Parent = colorPicker.RgbInputs[color]
                    
                    local rgbLabel = Instance.new("TextLabel")
                    rgbLabel.Name = "Label"
                    rgbLabel.Parent = colorPicker.RgbInputs[color]
                    rgbLabel.BackgroundTransparency = 1
                    rgbLabel.Position = UDim2.new(0, 0, 0, 0)
                    rgbLabel.Size = UDim2.new(0, 15, 1, 0)
                    rgbLabel.Font = Library.Fonts.Regular
                    rgbLabel.Text = color
                    rgbLabel.TextColor3 = Library.Theme.TextDark
                    rgbLabel.TextSize = 14
                    rgbLabel.ZIndex = Library.ZIndexOrder.Colorpicker
                    
                    colorPicker.RgbInputs[color].Input = Instance.new("TextBox")
                    colorPicker.RgbInputs[color].Input.Name = "Input"
                    colorPicker.RgbInputs[color].Input.Parent = colorPicker.RgbInputs[color]
                    colorPicker.RgbInputs[color].Input.BackgroundTransparency = 1
                    colorPicker.RgbInputs[color].Input.Position = UDim2.new(0, 15, 0, 0)
                    colorPicker.RgbInputs[color].Input.Size = UDim2.new(0, 40, 1, 0)
                    colorPicker.RgbInputs[color].Input.Font = Library.Fonts.Regular
                    colorPicker.RgbInputs[color].Input.Text = tostring(math.floor(default[color:lower()] * 255))
                    colorPicker.RgbInputs[color].Input.TextColor3 = Library.Theme.Text
                    colorPicker.RgbInputs[color].Input.TextSize = 14
                    colorPicker.RgbInputs[color].Input.PlaceholderText = "0-255"
                    colorPicker.RgbInputs[color].Input.ZIndex = Library.ZIndexOrder.Colorpicker
                end
                
                -- Set up the color picker functionality
                function colorPicker:Set(color)
                    self.Value = color
                    self.Display.BackgroundColor3 = color
                    
                    -- Update RGB inputs
                    self.RgbInputs.R.Input.Text = tostring(math.floor(color.R * 255))
                    self.RgbInputs.G.Input.Text = tostring(math.floor(color.G * 255))
                    self.RgbInputs.B.Input.Text = tostring(math.floor(color.B * 255))
                    
                    -- Set wheel and brightness positions
                    local h, s, v = Library.Utility.RGBtoHSV(color.R * 255, color.G * 255, color.B * 255)
                    
                    -- Update color wheel position
                    local rad = s * 75
                    local angle = h * math.pi * 2
                    self.ColorWheelSelector.Position = UDim2.new(0.5 + math.cos(angle) * rad / 75, -4, 0.5 + math.sin(angle) * rad / 75, -4)
                    
                    -- Update brightness slider position
                    self.BrightnessSliderSelector.Position = UDim2.new(0, -2, 1 - v, -4)
                    
                    -- Update color gradient
                    local baseColor = Color3.fromHSV(h, s, 1)
                    self.BrightnessSliderGradient.Color = ColorSequence.new({
                        ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 0, 0)),
                        ColorSequenceKeypoint.new(1, baseColor)
                    })
                    
                    Library.Flags[flag] = color
                    callback(color)
                end
                
                -- Toggle the color picker
                function colorPicker:Toggle()
                    self.Open = not self.Open
                    
                    if self.Open then
                        -- Expand color picker
                        self.Picker.Visible = true
                        Library.Utility.Tween(self.Container, {Time = 0.2}, {Size = UDim2.new(1, 0, 0, 240)})
                    else
                        -- Collapse color picker
                        Library.Utility.Tween(self.Container, {Time = 0.2}, {Size = UDim2.new(1, 0, 0, 35)})
                        task.delay(0.2, function()
                            if not self.Open then
                                self.Picker.Visible = false
                            end
                        end)
                    end
                end
                
                -- Initialize wheel and brightness dragging
                local wheelDragging = false
                local brightnessDragging = false
                
                colorPicker.ColorWheel.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        wheelDragging = true
                        
                        local center = Vector2.new(
                            colorPicker.ColorWheel.AbsolutePosition.X + colorPicker.ColorWheel.AbsoluteSize.X/2,
                            colorPicker.ColorWheel.AbsolutePosition.Y + colorPicker.ColorWheel.AbsoluteSize.Y/2
                        )
                        
                        local radius = colorPicker.ColorWheel.AbsoluteSize.X/2
                        local mousePos = Vector2.new(input.Position.X, input.Position.Y)
                        local direction = (mousePos - center).Unit
                        local distance = math.min((mousePos - center).Magnitude, radius)
                        
                        colorPicker.ColorWheelSelector.Position = UDim2.new(0.5 + direction.X * distance/radius, -4, 0.5 + direction.Y * distance/radius, -4)
                        
                        -- Calculate hue and saturation
                        local h = math.atan2(direction.Y, direction.X) / (math.pi * 2)
                        if h < 0 then h = h + 1 end
                        
                        local s = distance / radius
                        
                        -- Get current brightness
                        local _, _, v = Library.Utility.RGBtoHSV(
                            colorPicker.Value.R * 255, 
                            colorPicker.Value.G * 255, 
                            colorPicker.Value.B * 255
                        )
                        
                        -- Create new color
                        local r, g, b = Library.Utility.HSVtoRGB(h, s, v)
                        colorPicker:Set(Color3.fromRGB(r, g, b))
                        
                        -- Update brightness gradient
                        local baseColor = Color3.fromHSV(h, s, 1)
                        colorPicker.BrightnessSliderGradient.Color = ColorSequence.new({
                            ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 0, 0)),
                            ColorSequenceKeypoint.new(1, baseColor)
                        })
                    end
                end)
                
                colorPicker.BrightnessSlider.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        brightnessDragging = true
                        
                        local sliderPosition = colorPicker.BrightnessSlider.AbsolutePosition.Y
                        local sliderHeight = colorPicker.BrightnessSlider.AbsoluteSize.Y
                        local mouseY = input.Position.Y
                        
                        local position = math.clamp((mouseY - sliderPosition) / sliderHeight, 0, 1)
                        colorPicker.BrightnessSliderSelector.Position = UDim2.new(0, -2, position, -4)
                        
                        -- Get current hue and saturation
                        local h, s = Library.Utility.RGBtoHSV(
                            colorPicker.Value.R * 255, 
                            colorPicker.Value.G * 255, 
                            colorPicker.Value.B * 255
                        )
                        
                        -- Create new color with updated brightness
                        local r, g, b = Library.Utility.HSVtoRGB(h, s, 1 - position)
                        colorPicker:Set(Color3.fromRGB(r, g, b))
                    end
                end)
                
                UserInputService.InputChanged:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseMovement then
                        if wheelDragging then
                            local center = Vector2.new(
                                colorPicker.ColorWheel.AbsolutePosition.X + colorPicker.ColorWheel.AbsoluteSize.X/2,
                                colorPicker.ColorWheel.AbsolutePosition.Y + colorPicker.ColorWheel.AbsoluteSize.Y/2
                            )
                            
                            local radius = colorPicker.ColorWheel.AbsoluteSize.X/2
                            local mousePos = Vector2.new(input.Position.X, input.Position.Y)
                            local direction = (mousePos - center).Unit
                            local distance = math.min((mousePos - center).Magnitude, radius)
                            
                            colorPicker.ColorWheelSelector.Position = UDim2.new(0.5 + direction.X * distance/radius, -4, 0.5 + direction.Y * distance/radius, -4)
                            
                            -- Calculate hue and saturation
                            local h = math.atan2(direction.Y, direction.X) / (math.pi * 2)
                            if h < 0 then h = h + 1 end
                            
                            local s = distance / radius
                            
                            -- Get current brightness
                            local _, _, v = Library.Utility.RGBtoHSV(
                                colorPicker.Value.R * 255, 
                                colorPicker.Value.G * 255, 
                                colorPicker.Value.B * 255
                            )
                            
                            -- Create new color
                            local r, g, b = Library.Utility.HSVtoRGB(h, s, v)
                            colorPicker:Set(Color3.fromRGB(r, g, b))
                            
                            -- Update brightness gradient
                            local baseColor = Color3.fromHSV(h, s, 1)
                            colorPicker.BrightnessSliderGradient.Color = ColorSequence.new({
                                ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 0, 0)),
                                ColorSequenceKeypoint.new(1, baseColor)
                            })
                        elseif brightnessDragging then
                            local sliderPosition = colorPicker.BrightnessSlider.AbsolutePosition.Y
                            local sliderHeight = colorPicker.BrightnessSlider.AbsoluteSize.Y
                            local mouseY = input.Position.Y
                            
                            local position = math.clamp((mouseY - sliderPosition) / sliderHeight, 0, 1)
                            colorPicker.BrightnessSliderSelector.Position = UDim2.new(0, -2, position, -4)
                            
                            -- Get current hue and saturation
                            local h, s = Library.Utility.RGBtoHSV(
                                colorPicker.Value.R * 255, 
                                colorPicker.Value.G * 255, 
                                colorPicker.Value.B * 255
                            )
                            
                            -- Create new color with updated brightness
                            local r, g, b = Library.Utility.HSVtoRGB(h, s, 1 - position)
                            colorPicker:Set(Color3.fromRGB(r, g, b))
                        end
                    end
                end)
                
                UserInputService.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        wheelDragging = false
                        brightnessDragging = false
                    end
                end)
                
                -- RGB input handling
                for _, color in pairs({"R", "G", "B"}) do
                    colorPicker.RgbInputs[color].Input.FocusLost:Connect(function(enterPressed)
                        if enterPressed then
                            local r = tonumber(colorPicker.RgbInputs.R.Input.Text) or colorPicker.Value.R * 255
                            local g = tonumber(colorPicker.RgbInputs.G.Input.Text) or colorPicker.Value.G * 255
                            local b = tonumber(colorPicker.RgbInputs.B.Input.Text) or colorPicker.Value.B * 255
                            
                            r = math.clamp(r, 0, 255)
                            g = math.clamp(g, 0, 255)
                            b = math.clamp(b, 0, 255)
                            
                            colorPicker:Set(Color3.fromRGB(r, g, b))
                        else
                            -- Reset to current values
                            colorPicker.RgbInputs.R.Input.Text = tostring(math.floor(colorPicker.Value.R * 255))
                            colorPicker.RgbInputs.G.Input.Text = tostring(math.floor(colorPicker.Value.G * 255))
                            colorPicker.RgbInputs.B.Input.Text = tostring(math.floor(colorPicker.Value.B * 255))
                        end
                    end)
                end
                
                -- Button click handler
                colorPicker.Button.MouseButton1Click:Connect(function()
                    colorPicker:Toggle()
                end)
                
                -- Create tooltip if specified
                if options.Tooltip then
                    colorPicker.Tooltip = Library.Utility.CreateTooltip(colorPicker.Container, options.Tooltip)
                end
                
                -- Register flag
                Library.Flags[flag] = {
                    Value = default,
                    Set = function(value)
                        colorPicker:Set(value)
                    end
                }
                
                -- Set initial value
                colorPicker:Set(default)
                
                return colorPicker
            end
            
            return section
        end
        
        -- Function to select a tab
        function self:SelectTab(tabName)
            if self.ActiveTab == tabName then return end
            
            -- Deselect current tab
            if self.ActiveTab then
                local currentTab = self.Tabs[self.ActiveTab]
                
                Library.Utility.Tween(currentTab.Button, {Time = 0.2}, {BackgroundColor3 = Library.Theme.Secondary})
                currentTab.ActiveIndicator.Visible = false
                
                if currentTab.Icon then
                    Library.Utility.Tween(currentTab.Icon, {Time = 0.2}, {ImageColor3 = Library.Theme.TextDark})
                end
                
                Library.Utility.Tween(currentTab.Title, {Time = 0.2}, {TextColor3 = Library.Theme.TextDark})
                currentTab.Container.Visible = false
            end
            
            -- Select new tab
            local tab = self.Tabs[tabName]
            self.ActiveTab = tabName
            
            Library.Utility.Tween(tab.Button, {Time = 0.2}, {BackgroundColor3 = Library.Theme.Primary})
            tab.ActiveIndicator.Visible = true
            
            if tab.Icon then
                Library.Utility.Tween(tab.Icon, {Time = 0.2}, {ImageColor3 = Library.Theme.Accent})
            end
            
            Library.Utility.Tween(tab.Title, {Time = 0.2}, {TextColor3 = Library.Theme.Accent})
            tab.Container.Visible = true
        end
        
        -- Select first tab if none is active
        function self:SelectFirstTab()
            for tabName, _ in pairs(self.Tabs) do
                self:SelectTab(tabName)
                break
            end
        end
        
        return tab
    end
    
    return window
end

-- Initialize the library when first used
Library:Init()
